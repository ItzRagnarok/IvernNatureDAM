<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Curso</title>
	<link rel="icon" href="/images/Logo.png">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link rel="stylesheet" href="/css/curso.css">
</head>

<body>
	<header th:replace="~{cabeceraMenu :: cabeceraMenu}"></header>
	<main>
		<section>
			<article class="cabeceraCurso">
				<div class="titCabeceraCurso">
					<img th:src="@{'/images/cursos/' + ${curso.imagenUrl}}" alt="Foto del curso" class="curso-logo">
					<h1 th:text="${curso.nombreGrupo}">Nombre del Grupo</h1>

					<a sec:authorize="hasAnyAuthority('ADMIN', 'ROLE_ADMIN')" class="editbtn" th:href="@{/cursos/editar/{id}(id=${curso.idcurso})}">
						<i class="fa-solid fa-pen-to-square"></i>
					</a>

					<form sec:authorize="hasAnyAuthority('ADMIN', 'ROLE_ADMIN')" th:action="@{/cursos/eliminar/{id}(id=${curso.idcurso})}" method="post"
						style="display: inline;">
						<button type="button" class="actionBtn deleteBtn">
							<i class="fa-solid fa-trash-can"></i>
						</button>
					</form>
				</div>
				<div class="tabs">
					<button class="tab" onclick="showSection('publicaciones')">Publicaciones</button>
					<button class="tab" onclick="showSection('contenidos')">Contenidos Educativos</button>
				</div>
			</article>

			<!-- Mostrar mensajes de error y éxito -->
			<div th:if="${message}" class="alert alert-success">
				<p th:text="${message}"></p>
			</div>
			<div th:if="${errorMessage}" class="alert alert-danger">
				<p th:text="${errorMessage}"></p>
			</div>

			<article id="publicaciones" class="section" style="display:block;">
				<h2>Chat</h2>
				<div class="comentarios">
					<ul class="lista-comentarios">
						<li th:each="comentario : ${respuestas}">
							<p th:text="${comentario.texto}">Texto del comentario</p>
						</li>
					</ul>
					<form th:action="@{/comentar}" method="post">
						<input type="text" name="comentario" placeholder="Escribe un comentario...">
						<button type="submit">Enviar</button>
					</form>
				</div>
			</article>

			<article id="contenidos" class="section" style="display:none;">
				<h2>Contenidos</h2>
				<form th:action="@{/cursos/curso/{id}/agregarContenido(id=${curso.idcurso})}" method="post"
					enctype="multipart/form-data">
					<input type="file" name="file">
					<input type="text" name="titulo" placeholder="Título del contenido">
					<button type="submit">Subir Contenido</button>
				</form>
				<table>
					<thead>
						<tr>
							<th>Tipo</th>
							<th>Título</th>
							<th>Descargar</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="contenido : ${curso.contenidos}">
							<td>
								<i class="fa" th:classappend="${fileTypeUtils.getIconClass(contenido.tipoArchivo)}"></i>
								<span th:text="${fileTypeUtils.getSimpleType(contenido.tipoArchivo)}"></span>
							</td>
							<td th:text="${contenido.titulo}">Título del Contenido</td>
							<td>
								<a th:href="@{/cursos/descargar/{idContenido}(idContenido=${contenido.idcontenidoeducativo})}" download th:text="'Descargar - ' + ${contenido.url}">Descargar</a>
							</td>
						</tr>
					</tbody>
				</table>
				
			</article>

			<!-- Modal -->
			<div id="modalConfirmacion" class="modal">
				<div class="modal-content">
					<h2>Confirmar Eliminación</h2>
					<p>¿Estás seguro de que deseas eliminar este curso?</p>
					<button id="confirmDelete">Eliminar</button>
					<button id="cancelDelete">Cancelar</button>
				</div>
			</div>
		</section>
	</main>
	<footer th:replace="~{footer :: footerPaginas}"></footer>
	<script>
		function showSection(sectionId) {
			var sections = document.querySelectorAll('.section');
			sections.forEach(function (section) {
				section.style.display = 'none';
			});
			var selectedSection = document.getElementById(sectionId);
			if (selectedSection) {
				selectedSection.style.display = 'block';
			} else {
				console.error('No se encontró la sección: ' + sectionId);
			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			var modal = document.getElementById("modalConfirmacion");
			var confirmBtn = document.getElementById("confirmDelete");
			var cancelBtn = document.getElementById("cancelDelete");
			var deleteForm = null;

			document.querySelectorAll('.deleteBtn').forEach(btn => {
				btn.addEventListener('click', function (event) {
					event.preventDefault();
					modal.style.display = "block";
					deleteForm = this.closest('form');
				});
			});

			confirmBtn.addEventListener('click', function () {
				modal.style.display = "none";
				if (deleteForm) deleteForm.submit();
			});

			cancelBtn.addEventListener('click', function () {
				modal.style.display = "none";
			});

			window.onclick = function (event) {
				if (event.target === modal) {
					modal.style.display = "none";
				}
			};
		});
	</script>
</body>

</html>
